% !TeX root = 000-main.tex
\documentclass[000-main.tex]{subfiles}

\begin{document}

\subsection{Schemes}%
\label{sec:schemes}

Suppose $A$ is a (commutative) ring, and recall that an ideal $\mathfrak{p}\subset A$ is \emph{prime} if $ab\in\mathfrak{p}\implies a\in \mathfrak{p}$ or $b\in\mathfrak{p}$.
As a matter of convention, we will assume that a prime ideal is necessarily not equal to the entire ring.
We can now associate a topological space to $A$,
\begin{definition}
  Let,
  \[
	\Spec A := \lbrace\text{prime ideals in }A\rbrace.
  \]
  Moreover, for an ideal $\mathfrak{a}$ let the \emph{variety} or \emph{vanishing} of $\mathfrak{a}$ be,
  \[
	V(\mathfrak{a}) := \lbrace\mathfrak{b} \in \Spec A \, | \, \mathfrak{a} \subseteq \mathfrak{b} \rbrace,
  \]
  We define a topology on $\Spec A$ by letting the $V(\mathfrak{a})$ be the closed sets.
  This is analogous to the Zariski topology on a variety.
\end{definition}

\begin{remark}[Notation and Principal Open Sets]
  For a general $S\subset A$, we define $V(S)$ to be the vanishing of the ideal generated by $S$.
  If $S = \left\{ f \right\}$, we will often just write $V(f)$.

  It can be useful for some proofs to work with an open basis of the topology.
  This is provided by the \emph{principal open sets} $D(f) := \Spec A\setminus V(f)$ for any $f \in A$.
\end{remark}

\begin{lemma}[\citeauthor{hartshorneAlgebraicGeometry1977}~{\cite[][70]{hartshorneAlgebraicGeometry1977}} Lemma II.2.1]
  The topology defined really is a topology.
\end{lemma} 

\begin{example}[Fields and Polynomial Rings]
  \begin{itemize}
    Suppose $k$ is a field.
    \item If $A = k$, the only prime ideal of $A$ is $(0)$, so $\Spec k$ is a point.
    Note the Krull dimension of $k$ is 0.

    \item Consider now $A = k[x]$.
    We then have prime ideals $(0)$ and $(f)$ where $f$ is an irreducible polynomial.
    When $k$ is algebraically closed the only irreducibles are of the form $x-a$ where $a \in k$.

    Clearly $(0)$ is never in the closure of any ideal (except itself), and $V(x-a) = \qty{(x-a)}$, so each $(x-a)$ is a closed point. % GC to LDH: What do you mean by closure here?
    We see that the closed points are in bijection with the underlying field.

    \item For one more example in this vein, consider $A = k[x, y]$ where we will again assume $k$ to be algebraically closed.
    The points in $\Spec$ are given by $(0)$, $(f)$ for $f \in k[x, y]$ irreducible, and $(x-a, y-b)$ for $a,b \in k$.
    The closed points are the $(x-a, y-b)$.

    Given $f$ such that $f(a,b)=0$, we see that $V(f) \cap V((x-a, y-b)) = V((x-a, y-b))$, so now the Krull dimension is 2, and we have generic points distributed along the zero locus of any irreducible $f$.
  \end{itemize}
\end{example}

\begin{remark}
  In the examples above we have seen that for the rings $R$ in question $\dim R[x] = \dim R + 1$.
  It is easy to see that $\dim R[x] \geq \dim R + 1$, and in fact for Noetherian rings equality holds, and this is the last exercise in \citeauthor{atiyahIntroductionCommutativeAlgebra2000}~\cite{atiyahIntroductionCommutativeAlgebra2000}.
\end{remark}

\paragraph{Topology of $\Spec A$}

It is useful to recall some topological facts about $\Spec A$ which we collect here.
Proofs can be found in \citeauthor{altmanTermCommutativeAlgebra2013}~\cite[][ยง13]{altmanTermCommutativeAlgebra2013}.

First, recall the \emph{Scheinnullstellensatz},
\begin{theorem}
  Let $A$ be a ring, $\mathfrak{a}\subset A$ then ideal, then
  \begin{displaymath}
    \sqrt{\mathfrak{a}} := \left\{ x\in A \mid \exists n\in\Zpl, x^n\in \mathfrak{a} \right\} = \bigcap_{\mathfrak{p}\supset\mathfrak{a}}\mathfrak{p}
  \end{displaymath}
  for all prime ideals $\mathfrak{p}\subset A$.
  If $\mathfrak{a}$ is contained in no prime ideals, the intersection is defined to be $A$.
\end{theorem}

\begin{lemma}[Antitone Galois Correspondence for Varieties]
  Let $A$ be a ring, $\mathfrak{a}, \mathfrak{b}\subset A$ ideals.
  Then,
  \begin{itemize}
    \item $\mathfrak{a}\subset \mathfrak{b}\implies V(\mathfrak{a}) \supset V(\mathfrak{b})$
    \item $V(\mathfrak{a}) \supset V(\mathfrak{b}) \implies \mathfrak{a} \subset \sqrt{\mathfrak{b}}$
    \item $V(\mathfrak{a}) = V(\mathfrak{b}) \iff \sqrt{\mathfrak{a}} = \sqrt{\mathfrak{b}}$
    \item $V(\mathfrak{a}) \cup V(\mathfrak{b}) = V(\mathfrak{a} \cap \mathfrak{b}) = V(\mathfrak{a}\mathfrak{b})$
    \item $\bigcap_\lambda V(\mathfrak{a}_\lambda) = V\qty(\sum_\lambda \mathfrak{a}_\lambda)$
  \end{itemize}
  In short, $V$ is an antitone Galois correspondence from the lattice of radical ideals of $A$ to the lattice of closed sets of $\Spec A$ (both ordered by inclusion).
\end{lemma}
This yields a corollary about maximal ideals,
\begin{corollary}
  If $\mathfrak{p}\in\Spec A$ is maximal, then the point $\left\{ \mathfrak{p} \right\}$ is closed, that is $V(\mathfrak{p}) = \left\{ \mathfrak{p} \right\}$.
\end{corollary}

And the following corollaries for principal open sets,
\begin{corollary}
  Let $A$ be a ring, $f, g\in A$.
  Then
  \begin{itemize}
    \item $(f) \subset (g)$ (equivalently, $f$ divides $g$) $\implies D(f) \subset D(g)$
    \item $D(f) \subset D(g) \implies (f) \subset \sqrt{(g)}$ (equivalently, $f$ divides some positive power of $g$)
    \item $D(f) = D(g) \iff \sqrt{(f)} = \sqrt{(g)}$
    \item $D(f) \cap D(g) = D(fg)$
    \item $\bigcup_\lambda D(f_\lambda) = D(\sum_\lambda f_\lambda)$
  \end{itemize}
\end{corollary}

\begin{proposition}
  Let $A$ be a ring, then $\Spec A$ is a \emph{quasi-compact} topological space.
  That is, if $\Spec A = \bigcup_{\lambda\in \Lambda}U_\lambda$, then there exists a finite subcover, $\Spec A = \bigcup_{i = 1}^n U_{\lambda_i}$ for some ${\qty{\lambda_i}}^n_{i = 1}\subset \Lambda$.
\end{proposition}
N.B.\ this property is what non-(algebraic geometers) would usually call compactness.
Instead of proving this proposition, we will prove the slightly more general statement below,
\begin{proposition}
  The principal open sets $D(f)$ are quasi-compact with the subspace topology.
\end{proposition}

\subsubsection{The Structure Sheaf}%
\label{sec:structure-sheaf}

We now want to define a sheaf over $\Spec A$.
However, it is useful to recall some ideas about localisation before proceeding.
All of these facts can be found in~\cite[][81-86]{altmanTermCommutativeAlgebra2013} or~\cite[][36-49]{atiyahIntroductionCommutativeAlgebra2000}.

\paragraph{Localisation}

Recall that $S\subset A$ is \emph{multiplicative} if $a, b\in S \implies ab\in S$.
The \emph{localisation of $A$ away from $S$} is the ring consisting of pairs,
\begin{displaymath}
  S^{-1}A := \left\{ a/s \mid s\in S, a\in A \right\}/\sim
\end{displaymath}
where,
\begin{displaymath}
  a/s \sim b/t \iff
  \exists u\in S, u(at - bs) = 0
\end{displaymath}

It is also convenient to define the \emph{annihilator}, $\Ann(a) = \left\{ x\in A \mid xa = 0 \right\}$ (writing $\Ann(S) = \bigcap_{s\in S}\Ann(s)$ for $S\subset A$).
Note that the annihilator is clearly an ideal of $A$.
With this, equivalence relation becomes,
\begin{displaymath}
  a/s \sim b/t \iff
  S\cap\Ann(at - bs) \neq \varnothing
\end{displaymath}
An immediate consequence of this definition is that $S\subset {(S^{-1}A)}^{\times}$.

There are two particularly important examples of localisations:
\begin{itemize}
  \item localising away from $\left\{a, a^2, \ldots \right\}$ for $a\in A$, and
  \item localising away from $A\setminus\mathfrak{p}$ for some prime ideal $\mathfrak{p}\subset A$.
\end{itemize}
we call the first \emph{localising away from $a$} and the second \emph{localising at $\mathfrak{p}$}.

Confusingly, these rings are commonly written $A_a$ and $A_{\mathfrak{p}}$ respectively.
Even more frustratingly, the usage of localisation \emph{at} vs.\ localisation \emph{away from} is also subject to convention.
GC suggests using \emph{at} only when we are localising with respect to the complement of a prime ideal, and \emph{away from} for anything else.

In the particular case of localising at primes, $A_\mathfrak{p}$ is an example of a \emph{local ring}, i.e.\ one with a unique maximal ideal, $\mathfrak{p}$.
Moreover, given a homomorphism of rings, $\phi : A \to B$, and $\mathfrak{q}\subset B$ prime, we have a homomorphism of local rings $\phi_{\mathfrak{q}} : A_{\phi^{-1}(\mathfrak{q})} \to B_{\mathfrak{q}}$.

For any multiplicative set $S$, there is always a homomorphism $\imath_S: A \to S^{-1}A, a\mapsto a/1$, hence $S^{-1}A$ is always an $A$-algebra.
Indeed, we have the following useful characterisation of localisations,
\begin{lemma}[UMP of Localisations]
  Let $A$ be a ring, $S\subset A$ a multiplicative subset, then every $A$-algebra which maps $S$ to units factors through $(S^{-1}A, \imath_S)$.
  i.e.\ for every $A$-algebra $(B, f)$ satisfying $f(S)\subset B^{\times}$ there exists a unique $\phi$ such that the following diagram commutes,
  \begin{displaymath}
    \begin{tikzcd}
      S \rar[hook] \dar{f} & A \dar{f} \rar{\imath_S} & S^{-1}A \dlar[dashed]{\phi}\\
      B^{\times} \rar[hook] & B
    \end{tikzcd}
  \end{displaymath}

\end{lemma}
Note that:
\begin{itemize}
  \item $\imath_S$ is injective if and only if $S\cap \Ann(A) \neq \varnothing$.
  \item TFAE:
        \begin{itemize}
          \item $\imath_S$ is surjective,
          \item $\imath_S$ is bijective,
          \item $S \subset A^{\times}$
        \end{itemize}
\end{itemize}

Naturally:
\begin{itemize}
  \item If we have multiplicative sets $T \subset S$, there is a homomorphism $T^{-1}A \to S^{-1}A$.
  \item The above implies that if we have prime ideals $\mathfrak{p}\subset\mathfrak{q}$, we have $A_\mathfrak{q} \to A_\mathfrak{p}$.
  \item Moreover, if $\mathfrak{p}\in D(f) \implies \left\{ 1, f, f^2, \ldots \right\}\subset A\setminus\mathfrak{p}$, we have $A_f \to A_\mathfrak{p}$.
\end{itemize}

\paragraph{The Structure Sheaf}

\begin{definition}
  Let $\mathcal{O}_X$ be a sheaf on $X := \Spec A$ given by,
  \[
    \mathcal{O}_X(U) = \qty{
      s \in \Gamma\qty(U, \bigsqcup_{\mathfrak{p} \in U} A_{\mathfrak{p}})
      \middle\vert
      s\text{ satisfies~\eqref{eq:str-sheaf-cond-harts}}
    }
  \]
  where~\eqref{eq:str-sheaf-cond-harts} is the condition,
  \begin{equation}\label{eq:str-sheaf-cond-harts}
      \forall \mathfrak{p}\in U,
      \exists f_{\ast} \not\in \mathfrak{p},
      \exists V_{\ast}\in \mathcal{N}(\mathfrak{p}, U\cap D(f_{\ast})),
      \exists \alpha_{\ast} \in A_{f_\ast},
      \forall \mathfrak{q} \in V, s(\mathfrak{q}) = (\mathfrak{q}, \alpha_{\ast})
      \tag{\ast}
  \end{equation}
  $\mathcal{N}(p, U)$ being the set of open neighbourhoods of $p$ contained in $U$.

  We see that $\mathcal{O}_X$ is a sheaf of rings by defining $s + t$ and $st$ pointwise on fibres.
\end{definition}

The condition~\eqref{eq:str-sheaf-cond-harts} just says that the function $s$ looks locally like a quotient, mimicking the definition of a regular function on a variety (which is locally a quotient of polynomials).
This is made precise in the following manner,
\begin{proposition}
  For every $f\in A$, we have $\mathcal{O}_X(D(f)) \cong A_f$.
\end{proposition}
The proof below follows \citeauthor{hartshorneAlgebraicGeometry1977}~\cite[][71-72]{hartshorneAlgebraicGeometry1977} with some minor changes.
\begin{proof}\TOPROVE
  Fix $f\in A$ and recall that for every $\mathfrak{p}\in D(f)$ we have a natural map $\imath_{\mathfrak{p}}: A_f \to A_\mathfrak{p}$.
  Thus we define,
  \begin{displaymath}
    \begin{gathered}
      \psi: A_f \to \Gamma\qty(D(f), \coprod_{\mathfrak{p}\in D(f)}A_\mathfrak{p})\\
      \alpha \mapsto (\mathfrak{p}\mapsto (\mathfrak{p}, \imath_{\mathfrak{p}}(\alpha)))
    \end{gathered}
  \end{displaymath}
  Note that for any $\alpha\in A_f$ and any $\mathfrak{p}\in D(f)$, we can just take $(f_\ast, V_\ast, \alpha_\ast) := (f, D(f), \alpha)$ and we satisfy~\eqref{eq:str-sheaf-cond-harts}.
  Thus $\psi$ is a well defined map $\psi: A_f \to \mathcal{O}_X(D(f))$, the fact that it is a homomorphism of rings follows immediately from $\imath_{\mathfrak{p}}$ being a homomorphism of rings.

  We first show that $\psi$ is injective.
  Suppose $\psi(a/f^n) = \psi(b/f^m)$, then for any $\mathfrak{p}\in D(f)$, we must have $\imath_\mathfrak{p}(a/f^n) = \imath_\mathfrak{p}(b/f^m)$, i.e.\ letting $\mathfrak{a := }\Ann(af^m - bf^n)$, $(A\setminus \mathfrak{p})\cap \mathfrak{a} = \mathfrak{a}\setminus\mathfrak{p}\neq\varnothing$.
  Thus,
  \begin{align*}
    \forall\mathfrak{p}\in D(f), \mathfrak{a} \not\subset \mathfrak{p}
    &\implies \forall \mathfrak{p}\in D(f), \mathfrak{p}\not\in V(\mathfrak{a})\\
    &\implies D(f)\cap V(\mathfrak{a}) = \varnothing\\
    &\implies V(f) \supset V(\mathfrak{a})\\
    &\implies f \in \sqrt{\mathfrak{a}}\\
    &\implies \exists l\in\Zpl, f^l\in \mathfrak{a}\\
    &\implies \exists l\in\Zpl, f^l(af^m - bf^n) = 0\\
    &\implies a/f^n = b/f^m
  \end{align*}
  and we are done.

  To show surjectivity, suppose $s\in \mathcal{O}_X(D(f))$.
  By~\eqref{eq:str-sheaf-cond-harts}, for every $\mathfrak{p}\in D(f)$, there exists:
  \begin{itemize}
    \item $f_\mathfrak{p}\not\in \mathfrak{p}$,
    \item $V_\mathfrak{p}\in \mathcal{N}(p, D(f)\cap D(f_\mathfrak{p}))$
  \end{itemize}
  such that $\exists \alpha_\mathfrak{p}\in A_{f_\mathfrak{p}}, \forall \mathfrak{q}\in V_\mathfrak{p}, s(\mathfrak{q}) = \alpha_\mathfrak{p}$.

  Assuming WLOG $V_\mathfrak{p} = D(h_\mathfrak{p})$, we see that $D(h_\mathfrak{p}) \subset D(f)\cap D(f_\mathfrak{p}) \implies h_\mathfrak{p}\in \sqrt{(f_\mathfrak{p})}$
\end{proof}

Moreover, the structure sheaf has the following important property,
\begin{lemma}
  The stalk $\mathcal{O}_{\mathfrak{p}}$ is isomorphic to $A_{\mathfrak{p}}$, not just as a ring but as a local ring.
\end{lemma}
\begin{proof}\TOPROVE
  Let $\mathfrak{p}\in\Spec A$, we then have $\mathcal{O}_{X,\mathfrak{p}} := \varinjlim_{U\ni\mathfrak{p}}\mathcal{O}_X(U) = \varinjlim_{D(f)\ni\mathfrak{p}}\mathcal{O}_X(D(f))$ which is isomorphic to $\varinjlim_{f\in A\setminus\mathfrak{p}}A_f$.
\end{proof}

We call the pair $(\Spec A, \mathcal{O})$ the \emph{spectrum} of $A$.

\begin{definition}
  We shall call a pair $(X, \mathcal{O}_X)$, where $X$ is a topological space and $\mathcal{O}_X$ is a sheaf of rings over it, a \emph{ringed space}.
  Define a morphism of ringed spaces to be a pair $(f : X \to Y, f^\sharp : \mathcal{O}_Y \to f_\ast \mathcal{O}_X)$, where $f, f^\sharp$ are morphisms in the corresponding categories.

  We shall say that $(X, \mathcal{O}_X)$ is moreover a \emph{locally ringed space} if the stalk $\mathcal{O}_{X, P}$ at $P \in X$ is a local ring and $f^\sharp_P : \mathcal{O}_{Y, f(P)} \to \mathcal{O}_{X, P}$ is a local ring hom.
\end{definition}

\begin{lemma}
  $(\Spec A, \mathcal{O})$ is a locally ringed space, and the assignment $A \mapsto (\Spec A , \mathcal{O})$ is a contravariant functor.
\end{lemma}

These brief preliminaries have led up to the definition we wanted in this section. 

\begin{definition}
  An \emph{affine scheme} is a locally ringed space $(X, \mathcal{O}_X)$ which is isomorphic to $(\Spec A, \mathcal{O})$ for some $A$.
  A \emph{scheme} is a locally ringed space such that $\forall p \in X$, $\exists U \in \mathcal{N}(p, X)$ such that $(U, \left . \mathcal{O}_X \right \rvert_{U})$ is an affine scheme.
\end{definition}

\begin{example}
  \marginnote{LDH: Give a non-proj example of something which isn't an affine scheme.}
\end{example}

One important example of a scheme that is not affine will be $\Proj$, defined as follows: given a graded ring $S$ (with $S_+ = \bigoplus_{d > 0 } S_d$) the underlying topological space is 
\[
  \Proj S = \left \lbrace \mathfrak{p} \text{ homogeneous prime ideal} \, | \, S_+ \subsetneq \mathfrak{p} \right \rbrace ,
\] 
with topology and sheaf defined as before, but now with the sheaf given by maps into $\bigcup_{\mathfrak{p} \in U} S_{(\mathfrak{p})}$, where $S_{(\mathfrak{p})}$ is the ring of degree-0 elements of $T^{-1}S$ for $T$ the homogeneous elements not in $\mathfrak{p}$, and we require the sections to be locally a ration of element of the same fixed degree (equivalent to saying the map is into the degree 0 part). 

\marginnote{GC: Discussion about why this is locally affine required.}
\end{document}

% Local Variables:
% TeX-master: "000-main.tex"
% TeX-engine: luatex
% End:
